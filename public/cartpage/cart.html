<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장바구니</title>
    <link rel="stylesheet" href="cart.css">
</head>
<body>
    <header>
        <div class="logo"><a href="index.html"><img src="./img/logo1.png" alt="로고" width="85" height="65"></a></div>
        <div class="header-divider"></div> 
    </header>
    <div class="container">
        <div class="points">
            <span>보유 포인트: </span>
            <span class="point-amount">P</span>
        </div>
        <h2>장바구니 목록</h2>
        <div class="cart-items" id="cartList">
            <!-- 장바구니 아이템이 여기에 추가됩니다 -->
        </div>

        <div class="total">
            <span>총 합계</span>
            <span class="amount">0P</span>
        </div>
        <button id="checkoutButton">결제하기</button>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function updateCart() {
                const cartList = document.getElementById('cartList');
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                cartList.innerHTML = '';
                let total = 0;

                cart.forEach((product, index) => {
                    if (!product.quantity || product.quantity < 1) {
                        product.quantity = 1;
                    }

                    const cartItem = document.createElement('div');
                    cartItem.classList.add('cart-item');
                    cartItem.innerHTML = `
                        <img src="https://via.placeholder.com/100" alt="제품 이미지">
                        <div class="info">
                            <h3>${product.name}</h3>
                            <p>가격: ${parseInt(product.price).toLocaleString()}P</p>
                            <div class="quantity-control">
                                <button class="decrease-qty" data-index="${index}">-</button>
                                <span class="quantity">${product.quantity}</span>
                                <button class="increase-qty" data-index="${index}">+</button>
                            </div>
                        </div>
                        <button class="remove-item" data-index="${index}">삭제</button>
                    `;
                    cartList.appendChild(cartItem);
                    total += parseInt(product.price) * product.quantity;
                });

                document.querySelector('.total .amount').textContent = `${total.toLocaleString()}P`;

                const removeButtons = cartList.querySelectorAll('.remove-item');
                removeButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const index = this.getAttribute('data-index');
                        cart.splice(index, 1);
                        localStorage.setItem('cart', JSON.stringify(cart));
                        updateCart();
                    });
                });

                const increaseButtons = cartList.querySelectorAll('.increase-qty');
                const decreaseButtons = cartList.querySelectorAll('.decrease-qty');

                increaseButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const index = this.getAttribute('data-index');
                        cart[index].quantity += 1;
                        localStorage.setItem('cart', JSON.stringify(cart));
                        updateCart();
                    });
                });

                decreaseButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const index = this.getAttribute('data-index');
                        if (cart[index].quantity > 1) {
                            cart[index].quantity -= 1;
                            localStorage.setItem('cart', JSON.stringify(cart));
                            updateCart();
                        }
                    });
                });
            }

            const points = parseInt(localStorage.getItem('gamePoints')) || 0;
            document.querySelector('.points .point-amount').textContent = `${points.toLocaleString()} P`;

            updateCart();

            document.getElementById('checkoutButton').addEventListener('click', function() {
                const totalAmount = parseInt(document.querySelector('.total .amount').textContent.replace(/,/g, '').replace('P', ''));
                
                if (totalAmount === 0) {
                    alert('결제할 아이템이 없습니다.');
                } else if (points < totalAmount) {
                    alert('포인트가 부족합니다.');
                } else {
                    const newPoints = points - totalAmount;
                    localStorage.setItem('gamePoints', newPoints);
                    document.querySelector('.points .point-amount').textContent = `${newPoints.toLocaleString()} P`;

                    localStorage.removeItem('cart');
                    updateCart();

                    alert('결제가 완료되었습니다.');
                }
            });
        });
    </script>
</body>
</html>
